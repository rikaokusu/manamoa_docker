{% extends "common/base.html" %}
{% load i18n static %}
{% load is_exists %}
{% comment %} {% load get_file_id_value %} {% endcomment %}
{% load zfill %}
{% load get_model_obj %}
{% load btn_activate_ctl %}
{% load training_disabled %}
{% load training_check_date %}
{% load get_folder_is_open %}
{% load get_training_reguser_display_name %}
{% load get_training_reguser_company_pic_dept_name %}


{% block title %}トレーニング一覧 | {{ block.super }}{% endblock title %}

{% block content %}

{% comment %} <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"> {% endcomment %}
<link rel="stylesheet" href="{% static 'common/css/fontawesome.css' %}">


<style>
    /*---------------------------------

    アコーディオン

    ---------------------------------*/

    /* アコーディオン */
    .accordion {
        {% comment %} margin-top: 30px; {% endcomment %}
        margin-top: 30px;
        width: 100%;
    }

    /* アコーディオン タイトル */
    .accordion-title {
        position: relative;
        padding: 15px;
        color: #003379;
        font-size: 20px;
        display: block;
    }

    /* 縦線 */
    {% comment %} .accordion-title::before {
        cursor: pointer;
        background: #494949; /* 線の色 */
        content: "";
        height: 2px; /* 線の太さ */
        position: absolute;
        right: 25px;
        top: 50%; /* 線の位置を縦中央に */
        transform: rotate(90deg); /* 線を縦に */
        transition: transform .3s ease-in-out;
        width: 15px; /* 線の幅 */
    }

    /* 横線 */
    .accordion-title::after {
        cursor: pointer;
        background: #494949; /* 線の色 */
        content: "";
        height: 2px; /* 線の太さ */
        position: absolute;
        right: 25px;
        top: 50%; /* 線の位置を縦中央に */
        transition: opacity .3s ease-in-out;
        width: 15px; /* 線の幅 */
    }

    /* 縦線(クリック後) */
    .accordion-title.open::before {
        transform: rotate(180deg);
    }

    /* 横線(クリック後) */
    .accordion-title.open::after {
        opacity: 0;
    } {% endcomment %}


    .acd-check{
        display: none;
    }

    .accordion-title:after{
        /*background: #00479d;*/
        box-sizing: border-box;
        content: '\f067';
        display: block;
        font-family: "Font Awesome 5 Free";
        height: 52px;
        padding: 10px 20px;
        position: absolute;
        right: 0;
        top: 7px;
        font-weight: 900;
    }

    .acd-check:checked + .accordion-title:after{
        content: '\f068';
    }

    .acd-check:checked + .accordion-title + .accordion-content{
        display: block;
    }

    .accordion-content {
        display: none;
        padding: 10px 20px;
    }

    .accordion-content p {
        font-size: 13px;
        line-height: 1.5;
    }

    .accordion-item{
        margin-bottom: 15px;
    }

    /* タイトルの背景色 */
    .accordion-item .accordion-title {
        background-color: #cae5f6;
    }

    /* コンテンツボックスの枠線 */
    .accordion-item .accordion-content {
        border-bottom: 2px solid #d2e5f5;
        border-left: 2px solid #d2e5f5;
        border-right: 2px solid #d2e5f5;
    }

    /*---------------------------------

        タイトル

    ---------------------------------*/
    .training_title {
        padding: 0.25em 0.5em;/*上下 左右の余白*/
        color: #494949;/*文字色*/
        background: transparent;/*背景透明に*/
        border-left: solid 10px #7db4e6;/*左線*/
        {% comment %} margin-top: 20px; {% endcomment %}
        font-weight: bold;
        font-size: 25px;
    }

    .parts_label_status.glay {
        background-color: #CCCCCC;
    }

    .parts_label_status.blue {
        background-color: #3232FF;
        color: #fff;
    }

    .parts_label_status.done {
        background-color: #595959;
        color: #fff;
    }

    .parts_label_status {
        width: 100px;
        text-align: center;
        color: #000;
        vertical-align: middle;
    }


/*---------------------------------

    ラベル

---------------------------------*/

.waiting_label {
    width: 70px;
    line-height: 1.6;
    font-size: 1em;
    margin: 10px 0;
    font-weight: 700;
    vertical-align: text-bottom;
    color: #fff;
    padding: 7px 17px;
    -webkit-box-shadow: none;
    box-shadow: none;
    {% comment %} background-color: #ffb1c1; {% endcomment %}
    background-color: #ff8fa6;
    border-radius: 20px;
}

.working_label {
    width: 70px;
    line-height: 1.6;
    font-size: 1em;
    margin: 10px 0;
    font-weight: 700;
    vertical-align: text-bottom;
    color: #fff;
    padding: 7px 17px;
    -webkit-box-shadow: none;
    box-shadow: none;
    {% comment %} background-color: #9fcded; {% endcomment %}
    background-color: #7dc3f4;
    border-radius: 20px;
}

.done_label {
    width: 70px;
    line-height: 1.6;
    font-size: 1em;
    margin: 10px 0;
    font-weight: 700;
    vertical-align: text-bottom;
    color: #fff;
    padding: 7px 17px;
    -webkit-box-shadow: none;
    box-shadow: none;
    {% comment %} background-color: #bbdd92; {% endcomment %}
    background-color: #a3d26a;
    border-radius: 20px;
}

.deadline_label {
    width: 170px;
    line-height: 1.6;
    font-size: 1em;
    margin: 10px 0;
    font-weight: 700;
    vertical-align: text-bottom;
    color: #fff;
    padding: 7px 17px;
    -webkit-box-shadow: none;
    box-shadow: none;
    {% comment %} background-color: #d695c8; {% endcomment %}
    background-color: #d57bc2;
    border-radius: 20px;
}

.sapan_label {
    margin-left: 5px;
    font-size: 16px;
}


/*---------------------------------

    完了済みトレーニングを非表示にするボタン

---------------------------------*/
    .fas_button_training_done {
        display: block;
        position: relative;
        border: 2px solid #7cb4e6;
        width: 280px;
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        text-decoration: none;
        font-weight: bold;
        color: #494949;
        {% comment %} letter-spacing: .1rem; {% endcomment %}
        background-color: #fff;
        cursor: pointer;
    }

    .fas_button_training_done:before {
        position: absolute;
        top: 15%;
        left: 15px;
        width: 10px;
        color: #7cb4e6;
        font-family: "Font Awesome 5 Free";
        font-weight: 900;
        {% comment %} content: '\f00c'; {% endcomment %}
        font-size: 22px;
    }

    .fas_button_training_done:hover {
        background: #7cb4e6;
        color: #fff;
    }

    .fas_button_training_done:hover:before {
        position: absolute;
        top: 15%;
        left: 15px;
        width: 10px;
        color: #fff;
        font-family: "Font Awesome 5 Free";
        font-weight: 900;
        {% comment %} content: '\f00c'; {% endcomment %}
        font-size: 22px;
    }

    /* レイアウト用スタイル */
    .boxwrap{
        margin:40px auto;
        width:400px;
        padding:20px 60px;
        border:1px solid #ddd;
        background-color: #efefef;
    }
    .wrap{
        margin: auto;
        width: 300px;
        background-color: #7178a7;
        color: #fff;
        border-radius: 5px;
    }
    .mgb-20{
        margin-bottom: 20px;
    }
    .wrap.pattern-2{
        text-align:center;
        height:60px;
        line-height:60px;
    }

/*---------------------------------

    トレーニングが登録されていない場合の
    メッセージ

---------------------------------*/

    .fa-file {
        color: #afafaf;
        font-size: 100px;
    }

    .box2 {
        display: inline-block;
        text-align: center;
    }

/*---------------------------------

カード
---------------------------------*/

    .subject_card {
        display: flex;
        align-items: center;
        padding: 1rem;
        word-wrap: break-word;
        background-color: #fff;
        background-clip: border-box;
        border: 0;
        border-radius: 0.25rem;
        {% comment %} box-shadow: 0 10px 20px #ccc; {% endcomment %}
        box-shadow: 0px 1px 5px 0 rgb(0 0 0 / 20%);
        transition: 0.5s;
    }
    
    .card-image {
        width: 30%;
        height: 100px;
        object-fit: contain;
    }
    
    
    .card-box {
        padding-left: 1rem;
    }
    
    .subject-title {
        margin-bottom: 0.5rem;
        font-size: 1.2rem;
        font-weight: bold;
    }
    
    .card-description {
        margin-bottom: 0.5rem;
        line-height: 1.5;
    }
    
    .card-link {
        color: #333;
        text-decoration: none;
    }
    
    .card-link:hover .card {
        box-shadow: 0 5px 10px #ccc;
    }

    /*---------------------------------

    項目番号
    
    ---------------------------------*/
    .parts-number{
        color:#fff;
        border:4px solid #A0CCDB;
        background:#A0CCDB;
    }

    /*---------------------------------

    前のページに戻るボタン
    
    ---------------------------------*/
    
    .btn-grp {
    margin: 80px;
    }
    
    .return_btn {
    color: #ffffff !important;
    background: #7db4e6;
    }
    
    .my-btn-w12 {
    height: 45px;
    width: 300px;
    }


</style>


<div class="container-fluid">

    <!-- messages.succes や messages.errorにて利用 -->
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <p {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</p>
        {% endfor %}
    </div>
    {% endif %}




    <div class="mdl_align-height mt-3 mb-3">

        <div class="d-flex">
            <h4 class="training_title">トレーニング一覧</h4>
        </div>

        <div class="incident_done_btn_grp mt-4 d-flex align-items-center">

            <!-- トレーニングが登録されている場合 -->
            {% if user_training_count %}
                <!-- 表示切り替えボタン -->
                {% if is_training_done_chg %}
                    <!-- True 完了済みのトレーニングを表示✔ -->
                    <button class="fas_button_training_done incident_done_btn link mr-auto" data-done_disp_bool="false"><i class="far fa-check-square fa-lg mr-2"></i>完了したトレーニングを非表示にする</button>
                {% else %}
                    <!-- False 完了済みのトレーニングを非表示 -->
                    <button class="fas_button_training_done incident_done_btn link mr-auto" data-done_disp_bool="true"><i class="far fa-square fa-lg mr-2"></i>完了したトレーニングを非表示にする</button>
                {% endif %}

            <!-- 表示切り替えボタンを押せないようにする -->
            {% else %}
                <buton class="fas_button_training_done incident_done_btn link mr-auto" style="pointer-events: none; opacity: 0.5;"><i class="far fa-square fa-lg mr-2"></i>完了したトレーニングを非表示にする</buton>
            {% endif %}

            <!-- サマリ -->
            <div class="waiting_label">未対応</div><sapan class="sapan_label">{{training_manages_mitaiou}}件</sapan>
            <div class="working_label ml-3">対応中</div><sapan class="sapan_label">{{training_manages_taiou}}件</sapan>
            <div class="done_label ml-3" title="今日から1か月以内に完了したトレーニングを表示します">完了済</div><sapan class="sapan_label">{{training_manages_done_within_two_month}}件</sapan>

            <!-- トレーニングが登録されていない場合 -->
            {% if user_training_count == 0 %}
                <div class="deadline_label ml-3">期限が近いトレーニング</div><sapan class="sapan_label">{{task_plan_3month}}件</sapan>
            <!-- トレーニングが登録されている場合 -->
            {% else %}
                <div class="deadline_label ml-3">期限が近いトレーニング</div><sapan class="sapan_label">{{task_plan_3month}}件({{ statement_end_date.training.end_date }}まで)</sapan>
            {% endif %}

        </div>

    </div>

    <!-- トレーニングが登録されていない場合 -->
    {% if user_training_count == 0 %}
        <div class="box1 d-flex align-items-center justify-content-center">
            <div class="box2 mt-5">
                <i class="far fa-file"></i>
                <h4 class="card-title font-weight-bold text-black-50 mt-3">トレーニングが登録されていません</h4>
            </div>
        </div>

    <!-- トレーニングが登録されている場合 -->
    {% else %}

        <div class="row">

            {% for training in trainings %}

                {% with movie_count=training.movie.all|length %}
                {% with test_count=training.test.all|length %}
                {% with questionnaire_count=training.questionnaire.all|length %}

                <!-- パーツが未登録の場合 / 開始時刻にならないと全てのボタンが押せないようにする -->
                <div class="col-12 mt-2"
                    {% if training|training_disabled %}title="開始時刻までは操作できません"{% endif %}
                    {% if training.parts.all|length == 0 %}style="opacity: 0.5;" title="パーツが未登録のため操作できません"{% endif %}>

                    <div class="card home_card">

                        <div class="d-flex card_header">

                            {% comment %} <div class="d-none d-md-inline-block mt-2 ml-2 mb-2 mr-2" style="width: 700px;"> {% endcomment %}
                            <div class="d-md-inline-block mt-2 ml-2 mb-2 mr-2" style="width: 700px;">
                                <div class="d-flex">

                                    <div class="menu_title_size">{{forloop.counter|zfill:3}}.{{training.title}}</div>
                                    {% comment %} <div class="menu_title_size">{{forloop.counter|zfill:3}}.{{training_manage.training.title}}</div> {% endcomment %}

                                </div>
                                <div class="menu_desc_size menu_desc_text">{{training.description|safe}}</div>
                                {% comment %} <div class="menu_desc_size menu_desc_text">{{training_manage.training.description|safe}}</div> {% endcomment %}
                            </div>

                            {% comment %} <div class="d-none d-md-inline-block mt-2 ml-auto mr-2 mb-2" style="width: 220px;"> {% endcomment %}
                            <div class="d-md-inline-block mt-2 ml-auto mr-2 mb-2" style="width: 220px;">
                                <div class="d-flex">
                                    <div class="label_text label_text_w62 font-weight-bold text-muted">発信者</div>
                                    {% comment %} <div class="menu_reg_user_size menu_reg_user_text label_border_left pl-3 menu_reg_user_box">{{training.reg_user.company.pic_dept_name}}</div> {% endcomment %}
                                    <div class="menu_reg_user_size menu_reg_user_text label_border_left pl-3 menu_reg_user_box">{{training.reg_user|get_training_reguser_company_pic_dept_name}}</div>
                                </div>

                                <div class="d-flex">
                                    <div class="label_text label_text_w62" style="visibility:hidden;">発信者</div>
                                    {% comment %} <div class="menu_reg_user_size menu_reg_user_text label_border_left pl-3 menu_reg_user_box">{{training.reg_user.display_name}}</div> {% endcomment %}
                                    <div class="menu_reg_user_size menu_reg_user_text label_border_left pl-3 menu_reg_user_box">{{training.reg_user|get_training_reguser_display_name}}</div>
                                </div>

                                {% comment %} <div class="d-flex">
                                    <div class="label_text label_text_w62" style="visibility:hidden;">発信者</div>
                                    <div class="menu_reg_user_size menu_reg_user_text label_border_left pl-3 menu_reg_user_box"></div>
                                </div> {% endcomment %}

                            </div>

                            {% comment %} <div class="d-none d-md-inline-block mt-2 ml-3 mr-4 mb-2" style="width: 250px;"> {% endcomment %}
                            <div class="d-md-inline-block mt-2 ml-3 mr-4 mb-2" style="width: 250px;">
                                <div class="d-inline-flex">
                                    <div class="label_text label_text_w90 label_border_right font-weight-bold text-muted pr-3 mr-3">ステータス</div>
                                    {% with training_manage=training.training_manage.all|get_model_obj:current_user %}
                                        {% if training_manage.status == 1 %} <!-- 未対応 -->
                                            <div class="label_status menu_sutatus_size glay label_status_custom">{{training_manage.get_status_display}}</div>
                                        {% elif training_manage.status == 2 %} <!-- 対応中 -->
                                            <div class="label_status menu_sutatus_size blue label_status_custom">{{training_manage.get_status_display}}</div>
                                        {% elif training_manage.status == 3 %} <!-- 完了 -->
                                            <div class="label_status menu_sutatus_size done label_status_custom">{{training_manage.get_status_display}}</div>
                                        {% endif %}
                                    {% endwith %}

                                    <div class="ml-1 period_rem_date menu_sutatus_size" data-period_date="{{ training.end_date|date:'Y/m/d H:i' }}">ステータス</div>
                                    {% comment %} <div class="ml-1 period_rem_date menu_sutatus_size" data-period_date="{{ training_manage.training.end_date|date:'Y/m/d H:i' }}">ステータス</div> {% endcomment %}

                                </div>

                                <div class="menu_sutatus_size">

                                    <div class="d-flex">
                                        <div class="label_text label_text_w90 label_border_right text-muted font-weight-bold pr-3 mr-3">対応期限</div>
                                        <div class="menu_status_box" data-toggle="tooltip" title="{{ training.end_date|date:'Y/m/d H:i' }}">{{ training.end_date|date:'Y/m/d H:i'}}</div>
                                        {% comment %} <div class="menu_status_box" data-toggle="tooltip" title="{{ training_manage.training.end_date|date:'Y/m/d H:i' }}">{{ training_manage.training.end_date|date:'Y/m/d H:i'}}</div> {% endcomment %}

                                    </div>

                                    <div class="d-flex">
                                        <div class="label_text label_text_w90 label_border_right pr-3 mr-3"></div>
                                    </div>

                                    <div class="d-flex">
                                        <div class="label_text label_text_w90 label_border_right text-muted font-weight-bold pr-3 mr-3">対応完了</div>
                                        {% if training.status.id == 3 %} <!-- 完了 -->
                                        {% comment %} {% if training_manage.training.status.id == 3 %} <!-- 完了 --> {% endcomment %}
                                            <div class="menu_status_box" data-toggle="tooltip" title="{{ training.done_date|date:'Y/m/d H:i' }}">{{ training.done_date|date:'Y/m/d H:i'}}</div>
                                            {% comment %} <div class="menu_status_box" data-toggle="tooltip" title="{{ training_manage.training.done_date|date:'Y/m/d H:i' }}">{{ training_manage.training.done_date|date:'Y/m/d H:i'}}</div> {% endcomment %}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            {% comment %} <div class="d-none d-block mt-2 mb-2 ml-1 mr-3 align-self-center"> {% endcomment %}
                            <div class="d-block mt-2 mb-2 ml-1 mr-3 align-self-center">
                                <span class="detailed_search_group">
                                    <input id="detailed_search{{forloop.counter}}" class="detailed_search_btn" name="accordion-1" type="checkbox" data-training_id="{{ training.id }}" {%if folder_is_opens|get_folder_is_open:training %}checked{% endif %}/><!--" {% if folder.is_open %}checked{% endif %}> -->
                                    {% comment %} <label for="detailed_search{{forloop.counter}}" class="detailed_search_btn"></label> {% endcomment %}
                                    <label for="detailed_search{{forloop.counter}}"></label>
                                </span>

                            </div>

                        </div>
                    </div>

                    {% comment %} 詳細行 {% endcomment %}

                    <div class="childe1 mt-1">

                        {% for parts in training.parts.all %}
                        {% comment %} {% for parts in training_manage.training.parts.all|dictsort:'order' %} {% endcomment %}

                            {% if parts.type == 1 %}{% comment %} ファイル {% endcomment %}

                            <div class="card home_card">
                                <div class="d-flex ml-5 mr-5 card_body">

                                    {% comment %} <div class="d-none d-md-inline-block position-relative"> {% endcomment %}
                                    <div class="d-md-inline-block position-relative">
                                        <div class="maru size_m_l parts-number position-absolute maru_posi">
                                            <div class="letter_two_personal_l font-weight-bold">{{forloop.counter}}</div>
                                        </div>
                                    </div>

                                    {% comment %} <div class="d-none d-md-inline-block mt-3 ml-5 mb-3"> {% endcomment %}
                                    <div class="d-md-inline-block mt-3 ml-5 mb-3">
                                        <div class="">
                                            <i class="fas fa-file-download menu_icon"></i>
                                        </div>
                                    </div>

                                    {% comment %} <div class="d-none d-md-inline-block mt-3 ml-4 mb-3 mr-5 title_desc_box"> {% endcomment %}
                                    <div class="d-md-inline-block mt-3 ml-4 mb-3 mr-5 title_desc_box">
                                        <div class="d-flex flex-column">
                                            {% comment %} <div class="new up align-self-center mr-1 mt-1" data-created_time="{{ training.created_date|date:'Y/m/d H:i' }}">UP</div> {% endcomment %}
                                            <div class="menu_title_size">ファイルダウンロード</div>
                                            <div class="menu_desc_size menu_desc_text">{{parts.description}}</div>
                                            {% comment %} <div class="text-danger mb-2">※配布資料につきましては課内供覧を行うようお願いします。</div> {% endcomment %}
                                        </div>

                                        <div class="file_download d-flex flex-column">
                                        {% comment %} <span class="file_download d-flex flex-column"> {% endcomment %}
                                        {% for file in parts.file.all %}
                                            {% comment %} {% with file_download_manage=parts.parts_manage.all|first%} {% endcomment %}
                                            {% if parts.parts_manage %}

                                                {% with parts_manage=parts.parts_manage.all|get_model_obj:current_user %}

                                                {% comment %} {% for parts_manage in parts.parts_manage.all|get_model_obj:current_user %} {% endcomment %}
                                                    {% comment %} {% with is_file_exits=parts.parts_manage.file_manage.all|is_exists:file.file_id %} {% endcomment %}

                                                    <span style="display:block;">
                                                        {% with is_file_exits=parts_manage.file_manage.all|is_exists:file.file_id %}
                                                        <a href="{{file.file.url}}" id="{{ file.file_id }}" data-parts_id="{{ parts.id }}" download="{{ file.name }}" target="_blank" data-toggle="tooltip" title="{{ file.name }}">
                                                            <span class="">
                                                                <div class="d-inline"><i class="far fa-file-alt menu_file_icon_size menu_file_name_color"></i></div>
                                                                <div class="d-inline ml-1 align-self-center menu_file_name_size menu_file_name_color">{{ file.name }} <span class="download_status">{% if is_file_exits %} <i class="fas fa-check" style="color:#5f8499"></i> {%endif%}</span> </div>
                                                                {% comment %} <div class="d-inline ml-1 align-self-center menu_file_name_size menu_file_name_color">{{ file.name }}  </div> {% endcomment %}
                                                            </span>
                                                        </a>
                                                        {% endwith %}
                                                    </span>

                                                {% endwith %}

                                            {% else %}
                                                {% with is_file_exits="False" %}
                                                <a href="{{file.file.url}}" id="{{ file.file_id }}" data-parts_id="{{ parts.id }}" download="{{ file.name }}" target="_blank" data-toggle="tooltip" title="{{ file.name }}">
                                                    <div class="">
                                                        <div class="d-inline"><i class="far fa-file-alt menu_file_icon_size menu_file_name_color"></i></div>
                                                        <div class="d-inline ml-1 align-self-center menu_file_name_size menu_file_name_color">{{ file.name }} <span class="download_status">{% if is_file_exits != "False" %} <i class="fas fa-check" style="color:#5f8499"></i> {%endif%}</span> </div>
                                                        {% comment %} <div class="d-inline ml-1 align-self-center menu_file_name_size menu_file_name_color">{{ file.name }}  </div> {% endcomment %}
                                                    </div>
                                                </a>
                                                {% endwith %}
                                            {% endif %}
                                        {% endfor %}
                                        </div>
                                        {% comment %} </span> {% endcomment %}
                                    </div>

                                    {% comment %} <div class="d-none d-md-inline-block mt-3 ml-auto mr-2 mb-3 reg_user_box"> {% endcomment %}
                                    <div class="d-md-inline-block mt-3 ml-auto mr-2 mb-3 reg_user_box">
                                        <div class="menu_reg_user_size menu_reg_user_text">{{training.reg_user.company.pic_dept_name}}</div>
                                        {% comment %} <div class="menu_reg_user_size menu_reg_user_text">{{training_manage.training.reg_user.company.pic_dept_name}}</div> {% endcomment %}

                                        {% comment %} <div class="menu_reg_user_size menu_reg_user_text">{{training.reg_user.display_name}}</div> {% endcomment %}
                                        <div class="menu_reg_user_size menu_reg_user_text">{{training.reg_user.display_name}}</div>

                                    </div>

                                    {% comment %} <div class="d-none d-md-inline-block mt-3 ml-2 mr-2 mb-3"> {% endcomment %}
                                    <div class="d-md-inline-block mt-3 ml-2 mr-2 mb-3">

                                        {% with parts_manage=parts.parts_manage.all|get_model_obj:current_user %}

                                            {% if parts_manage.status == 1 %} <!-- 未対応 -->
                                                <div class="parts_label_status menu_sutatus_size glay">{{parts_manage.get_status_display}}</div>
                                            {% elif parts_manage.status == 2 %} <!-- 対応中 -->
                                                <div class="parts_label_status menu_sutatus_size blue">{{parts_manage.get_status_display}}</div>
                                            {% elif parts_manage.status == 3 %} <!-- 完了 -->
                                                <div class="parts_label_status menu_sutatus_size done">{{parts_manage.get_status_display}}</div>
                                            {% else %}<!-- 未対応 -->
                                                <div class="parts_label_status menu_sutatus_size glay">未対応</div>
                                            {% endif %}

                                        {% endwith %}

                                        <div class="text-center menu_sutatus_size">

                                            <div data-toggle="tooltip" title="{{ training.end_date|date:'Y/m/d H:i' }}">{{ training.end_date|date:'Y/m/d'}}</div>
                                            {% comment %} <div data-toggle="tooltip" title="{{ training_manage.training.end_date|date:'Y/m/d H:i' }}">{{ training_manage.training.end_date|date:'Y/m/d'}}</div> {% endcomment %}

                                            <div data-toggle="tooltip" title="{{ training.end_date|date:'Y/m/d H:i' }}">{{ training.end_date|date:'H:i'}}まで</div>
                                            {% comment %} <div data-toggle="tooltip" title="{{ training_manage.training.end_date|date:'Y/m/d H:i' }}">{{ training_manage.training.end_date|date:'H:i'}}まで</div> {% endcomment %}

                                            <div class="period_rem_date" data-period_date="{{ training.end_date|date:'Y/m/d H:i' }}">ステータス</div>
                                            {% comment %} <div class="period_rem_date" data-period_date="{{ training_manage.training.end_date|date:'Y/m/d H:i' }}">ステータス</div> {% endcomment %}


                                        </div>
                                    </div>

                                    {% comment %} <div class="d-none d-block mt-3 mb-3 ml-2 mr-3 menu_btn_color_div" {% if training|training_disabled %}style="pointer-events: none; opacity: 0.5;" title="開始時刻までは操作できません"{% endif %}> {% endcomment %}
                                    <div class="d-block mt-3 mb-3 ml-2 mr-3 menu_btn_color_div" {% if training|training_disabled %}style="pointer-events: none; opacity: 0.5;" title="開始時刻までは操作できません"{% endif %}>

                                        <!-- 期限切れトレーニングの有効化・無効化切り替えフラグがtrueの場合 -->
                                        {% if training.expired_training_flg %}
                                            <button type="button" class="menu_btn_color menu_btn my-btn zip_download" data-parts_id="{{ parts.id }}" onclick="window.location.href='{% url 'training:file_download_zip' parts.id %}'"
                                            {% if parts|btn_activate_ctl:current_user %}disabled{% endif %}>
                                                <div class="">
                                                    <div class="">
                                                        まとめて<br>ダウンロード
                                                    </div>
                                                </div>
                                            </button>
                                        {% else %}
                                            <button type="button" class="menu_btn_color menu_btn my-btn zip_download" data-parts_id="{{ parts.id }}" onclick="window.location.href='{% url 'training:file_download_zip' parts.id %}'"
                                            {% if training.end_date|training_check_date %}disabled{% endif %}
                                            {% if parts|btn_activate_ctl:current_user %}disabled{% endif %}>
                                                <div class="">
                                                    <div class="">
                                                        まとめて<br>ダウンロード
                                                    </div>
                                                </div>
                                            </button>
                                        {% endif %}
                                    </div>

                                </div>
                            </div>

                            {% endif %}

                            {% if parts.type == 2 %}{% comment %} 動画 {% endcomment %}

                                <div class="card home_card">

                                    <div class="d-flex ml-5 mr-5 card_body">

                                        {% comment %} <div class="d-none d-md-inline-block position-relative"> {% endcomment %}
                                        <div class="d-md-inline-block position-relative">
                                            <div class="maru size_m_l parts-number position-absolute maru_posi">
                                                <div class="letter_two_personal_l font-weight-bold">{{forloop.counter}}</div>
                                            </div>
                                        </div>


                                        {% comment %} <div class="d-none d-md-inline-block mt-3 ml-5 mb-3"> {% endcomment %}
                                        <div class="d-md-inline-block mt-3 ml-5 mb-3">
                                            <div class="">
                                                <i class="fas fa-file-video menu_icon"></i>
                                            </div>
                                        </div>

                                        {% comment %} <div class="d-none d-md-inline-block mt-3 ml-4 mb-3 mr-5 title_desc_box"> {% endcomment %}
                                        <div class="d-md-inline-block mt-3 ml-4 mb-3 mr-5 title_desc_box">
                                            <div class="menu_title_size"><span class="movie_title">{{parts.title}}</span><span class=" menu_desc_size float-right mt-1 mr-1"></span></div>
                                            <div class="menu_desc_size menu_desc_text">{{parts.description}}</div>
                                            <div class="menu_desc_size menu_desc_text"><i class="far fa-clock"></i>視聴時間 : 約{{parts.duration|default:"-----"}}</div>
                                        </div>

                                        {% comment %} <div class="d-none d-md-inline-block mt-3 ml-auto mr-2 mb-3 reg_user_box"> {% endcomment %}
                                        <div class="d-md-inline-block mt-3 ml-auto mr-2 mb-3 reg_user_box">
                                            <div class="menu_reg_user_size menu_reg_user_text">{{training.reg_user.company.pic_dept_name}}</div>
                                            {% comment %} <div class="menu_reg_user_size menu_reg_user_text">{{training_manage.training.reg_user.company.pic_dept_name}}</div> {% endcomment %}

                                            <div class="menu_reg_user_size menu_reg_user_text">{{training.reg_user.display_name}}</div>
                                            {% comment %} <div class="menu_reg_user_size menu_reg_user_text">{{training_manage.training.reg_user.display_name}}</div> {% endcomment %}

                                        </div>

                                        {% comment %} <div class="d-none d-md-inline-block mt-3 ml-2 mr-2 mb-3"> {% endcomment %}
                                        <div class="d-md-inline-block mt-3 ml-2 mr-2 mb-3">

                                            {% with parts_manage=parts.parts_manage.all|get_model_obj:current_user %}

                                                    {% if parts_manage.status == 1 %} <!-- 未対応 -->
                                                        <div class="parts_label_status menu_sutatus_size glay">{{parts_manage.get_status_display}}</div>
                                                    {% elif parts_manage.status == 2 %} <!-- 対応中 -->
                                                        <div class="parts_label_status menu_sutatus_size blue">{{parts_manage.get_status_display}}</div>
                                                    {% elif parts_manage.status == 3 %} <!-- 完了 -->
                                                        <div class="parts_label_status menu_sutatus_size done">{{parts_manage.get_status_display}}</div>
                                                    {% else %}
                                                        <div class="parts_label_status menu_sutatus_size glay">未対応</div>
                                                    {% endif %}

                                            {% endwith %}

                                            <div class="text-center menu_sutatus_size">

                                                <div data-toggle="tooltip" title="{{ training.end_date|date:'Y/m/d H:i' }}">{{ training.end_date|date:'Y/m/d'}}</div>
                                                {% comment %} <div data-toggle="tooltip" title="{{ training_manage.training.end_date|date:'Y/m/d H:i' }}">{{ training_manage.training.end_date|date:'Y/m/d'}}</div> {% endcomment %}

                                                <div data-toggle="tooltip" title="{{ training.end_date|date:'Y/m/d H:i' }}">{{ training.end_date|date:'H:i'}}まで</div>
                                                {% comment %} <div data-toggle="tooltip" title="{{ training_manage.training.end_date|date:'Y/m/d H:i' }}">{{ training_manage.training.end_date|date:'H:i'}}まで</div> {% endcomment %}

                                                <div class="period_rem_date" data-period_date="{{ training.end_date|date:'Y/m/d H:i' }}">ステータス</div>
                                                {% comment %} <div class="period_rem_date" data-period_date="{{ training_manage.training.end_date|date:'Y/m/d H:i' }}">ステータス</div> {% endcomment %}

                                            </div>
                                        </div>

                                        {% comment %} <div class="d-none d-block mt-3 mb-2 ml-2 mr-3 menu_btn_color_div"  {% if training|training_disabled %}style="pointer-events: none; opacity: 0.5;" title="開始時刻までは操作できません"{% endif %}> {% endcomment %}
                                        <div class="d-block mt-3 mb-2 ml-2 mr-3 menu_btn_color_div"  {% if training|training_disabled %}style="pointer-events: none; opacity: 0.5;" title="開始時刻までは操作できません"{% endif %}>
                                            <!-- 期限切れトレーニングの有効化・無効化切り替えフラグがtrueの場合 -->
                                            {% if training.expired_training_flg %}
                                                <button type="button" class="menu_btn_color menu_btn my-btn" onclick="window.open('{% url 'training:movie' parts.id %}', 'newwin', 'top=20,width=1090,height=830,resizable'); return false;"
                                                {% if parts|btn_activate_ctl:current_user %}disabled{% endif %}>
                                                    <div class="row no-gutters">
                                                        <div class="col-9">
                                                            <div class="mt-2 mb-2 button_text_size">
                                                                動画再生
                                                            </div>
                                                        </div>
                                                        <div class="col-3">
                                                            <div class="mt-2 mb-2 mr-0">
                                                                <i class="fas fa-external-link-alt fa-1x"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </button>
                                            {% else %}
                                                <button type="button" class="menu_btn_color menu_btn my-btn" onclick="window.open('{% url 'training:movie' parts.id %}', 'newwin', 'top=20,width=1090,height=830,resizable'); return false;"
                                                {% if training.end_date|training_check_date %}disabled{% endif %}
                                                {% if parts|btn_activate_ctl:current_user %}disabled{% endif %}>
                                                    <div class="row no-gutters">
                                                        <div class="col-9">
                                                            <div class="mt-2 mb-2 button_text_size">
                                                                動画再生
                                                            </div>
                                                        </div>
                                                        <div class="col-3">
                                                            <div class="mt-2 mb-2 mr-0">
                                                                <i class="fas fa-external-link-alt fa-1x"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </button>
                                            {% endif %}
                                        </div>

                                    </div>

                                </div>

                            {% endif %}

                            {% if parts.type == 3 %}{% comment %} テスト {% endcomment %}

                                <div class="card home_card">
                                    <div class="d-flex ml-5 mr-5 card_body">

                                        {% comment %} <div class="d-none d-md-inline-block position-relative"> {% endcomment %}
                                        <div class="d-md-inline-block position-relative">
                                            <div class="maru size_m_l parts-number position-absolute maru_posi">
                                                <div class="letter_two_personal_l font-weight-bold">{{forloop.counter}}</div>
                                            </div>
                                        </div>


                                        {% comment %} <div class="d-none d-md-inline-block mt-3 ml-5 mb-2"> {% endcomment %}
                                        <div class="d-md-inline-block mt-3 ml-5 mb-2">
                                            <div class="">
                                                {% comment %} <img class="w-100" src=static/training/img/test.png> {% endcomment %}
                                                <i class="fas fa-file-contract menu_icon"></i>
                                            </div>
                                        </div>

                                        {% comment %} <div class="d-none d-md-inline-block mt-3 ml-4 mb-3 mr-5 title_desc_box"> {% endcomment %}
                                        <div class="d-md-inline-block mt-3 ml-4 mb-3 mr-5 title_desc_box">
                                            <div class="menu_title_size">{{parts.title}}</div>
                                            <div class="menu_desc_size menu_desc_text">{{parts.description}}</div>
                                        </div>

                                        {% comment %} <div class="d-none d-md-inline-block mt-3 ml-auto mr-2 mb-3 reg_user_box"> {% endcomment %}
                                        <div class="d-md-inline-block mt-3 ml-auto mr-2 mb-3 reg_user_box">

                                            <div class="menu_reg_user_size menu_reg_user_text">{{training.reg_user.company.pic_dept_name}}</div>
                                            {% comment %} <div class="menu_reg_user_size menu_reg_user_text">{{training_manage.training.reg_user.company.pic_dept_name}}</div> {% endcomment %}

                                            <div class="menu_reg_user_size menu_reg_user_text">{{training.reg_user.display_name}}</div>
                                            {% comment %} <div class="menu_reg_user_size menu_reg_user_text">{{training_manage.training.reg_user.display_name}}</div> {% endcomment %}

                                        </div>

                                        {% comment %} <div class="d-none d-md-inline-block mt-3 ml-2 mr-2 mb-3"> {% endcomment %}
                                        <div class="d-md-inline-block mt-3 ml-2 mr-2 mb-3">

                                            {% with parts_manage=parts.parts_manage.all|get_model_obj:current_user %}

                                                    {% if parts_manage.status == 1 %} <!-- 未対応 -->
                                                        <div class="parts_label_status menu_sutatus_size glay">{{parts_manage.get_status_display}}</div>
                                                    {% elif parts_manage.status == 2 %} <!-- 対応中 -->
                                                        <div class="parts_label_status menu_sutatus_size blue">{{parts_manage.get_status_display}}</div>
                                                    {% elif parts_manage.status == 3 %} <!-- 完了 -->
                                                        <div class="parts_label_status menu_sutatus_size done">{{parts_manage.get_status_display}}</div>
                                                    {% else %}
                                                        <div class="parts_label_status menu_sutatus_size glay">未対応</div>
                                                    {% endif %}

                                            {% endwith %}

                                            <div class="text-center menu_sutatus_size">

                                                <div data-toggle="tooltip" title="{{ training.end_date|date:'Y/m/d H:i' }}">{{ training.end_date|date:'Y/m/d'}}</div>
                                                {% comment %} <div data-toggle="tooltip" title="{{ training_manage.training.end_date|date:'Y/m/d H:i' }}">{{ training_manage.training.end_date|date:'Y/m/d'}}</div> {% endcomment %}

                                                <div data-toggle="tooltip" title="{{ training.end_date|date:'Y/m/d H:i' }}">{{ training.end_date|date:'H:i'}}まで</div>
                                                {% comment %} <div data-toggle="tooltip" title="{{ training_manage.training.end_date|date:'Y/m/d H:i' }}">{{ training_manage.training.end_date|date:'H:i'}}まで</div> {% endcomment %}

                                                <div class="period_rem_date" data-period_date="{{ training.end_date|date:'Y/m/d H:i' }}">ステータス</div>
                                                {% comment %} <div class="period_rem_date" data-period_date="{{ training_manage.training.end_date|date:'Y/m/d H:i' }}">ステータス</div> {% endcomment %}

                                            </div>
                                        </div>

                                        {% comment %} <div class="d-none d-block mt-3 mb-3 ml-2 mr-3 menu_btn_color_div" {% if training|training_disabled %}style="pointer-events: none; opacity: 0.5;" title="開始時刻までは操作できません"{% endif %}> {% endcomment %}
                                        <div class="d-block mt-3 mb-3 ml-2 mr-3 menu_btn_color_div" {% if training|training_disabled %}style="pointer-events: none; opacity: 0.5;" title="開始時刻までは操作できません"{% endif %}>

                                            <!-- 期限切れトレーニングの有効化・無効化切り替えフラグがtrueの場合 -->
                                            {% if training.expired_training_flg %}
                                                <button type="button" class="menu_btn_color menu_btn my-btn" onclick="window.open('{% url 'training:test' parts.id %}', 'newwin', 'top=20,width=1280,height=720,resizable'); return false;"
                                                {% if parts|btn_activate_ctl:current_user %}disabled{% endif %}>
                                                    <div class="row no-gutters">
                                                        <div class="col-9">
                                                            <div class="mt-2 mb-2 button_text_size">
                                                                試験実施
                                                            </div>
                                                        </div>
                                                        <div class="col-3">
                                                            <div class="mt-2 mb-2">
                                                                <i class="fas fa-external-link-alt fa-1x"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </button>
                                            {% else %}
                                                <button type="button" class="menu_btn_color menu_btn my-btn" onclick="window.open('{% url 'training:test' parts.id %}', 'newwin', 'top=20,width=1280,height=720,resizable'); return false;" 
                                                {% if training.end_date|training_check_date %}disabled{% endif %}
                                                {% if parts|btn_activate_ctl:current_user %}disabled{% endif %}>
                                                    <div class="row no-gutters">
                                                        <div class="col-9">
                                                            <div class="mt-2 mb-2 button_text_size">
                                                                試験実施
                                                            </div>
                                                        </div>
                                                        <div class="col-3">
                                                            <div class="mt-2 mb-2">
                                                                <i class="fas fa-external-link-alt fa-1x"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                            </button>
                                            {% endif %}
                                        </div>

                                    </div>
                                </div>

                            {% endif %}

                            {% if parts.type == 4 %}{% comment %} アンケート {% endcomment %}

                                <div class="card home_card">
                                    <div class="d-flex ml-5 mr-5 card_body">

                                        {% comment %} <div class="d-none d-md-inline-block position-relative"> {% endcomment %}
                                        <div class="d-md-inline-block position-relative">
                                            <div class="maru size_m_l parts-number position-absolute maru_posi">
                                                <div class="letter_two_personal_l font-weight-bold">{{forloop.counter}}</div>
                                            </div>
                                        </div>

                                        {% comment %} <div class="d-none d-md-inline-block mt-3 ml-5 mb-3"> {% endcomment %}
                                        <div class="d-md-inline-block mt-3 ml-5 mb-3">
                                            <div class="" >
                                                <i class="fas fa-file-alt menu_icon"></i>
                                            </div>
                                        </div>

                                        {% comment %} <div class="d-none d-md-inline-block mt-3 ml-4 mb-3 mr-5 title_desc_box"> {% endcomment %}
                                        <div class="d-md-inline-block mt-3 ml-4 mb-3 mr-5 title_desc_box">
                                            <div class="menu_title_size">{{parts.title}}</div>
                                            <div class="menu_desc_size menu_desc_text">{{parts.description}}</div>
                                        </div>


                                        {% comment %} <div class="d-none d-md-inline-block mt-3 ml-auto mr-2 mb-3 reg_user_box"> {% endcomment %}
                                        <div class="d-md-inline-block mt-3 ml-auto mr-2 mb-3 reg_user_box">
                                            <div class="menu_reg_user_size menu_reg_user_text">{{training.reg_user.company.pic_dept_name}}</div>
                                            {% comment %} <div class="menu_reg_user_size menu_reg_user_text">{{training_manage.training.reg_user.company.pic_dept_name}}</div> {% endcomment %}

                                            <div class="menu_reg_user_size menu_reg_user_text">{{training.reg_user.display_name}}</div>
                                            {% comment %} <div class="menu_reg_user_size menu_reg_user_text">{{training_manage.training.reg_user.display_name}}</div> {% endcomment %}

                                        </div>

                                        {% comment %} <div class="d-none d-md-inline-block mt-2 ml-2 mr-2 mb-2"> {% endcomment %}
                                        <div class="d-md-inline-block mt-2 ml-2 mr-2 mb-2">
                                            {% with parts_manage=parts.parts_manage.all|get_model_obj:current_user %}

                                                {% if parts_manage.status == 1 %} <!-- 未対応 -->
                                                    <div class="parts_label_status menu_sutatus_size glay">{{parts_manage.get_status_display}}</div>
                                                {% elif parts_manage.status == 2 %} <!-- 対応中 -->
                                                    <div class="parts_label_status menu_sutatus_size blue">{{parts_manage.get_status_display}}</div>
                                                {% elif parts_manage.status == 3 %} <!-- 完了 -->
                                                    <div class="parts_label_status menu_sutatus_size done">{{parts_manage.get_status_display}}</div>
                                                {% else %}
                                                    <div class="parts_label_status menu_sutatus_size glay">未対応</div>
                                                {% endif %}

                                            {% endwith %}

                                            <div class="text-center menu_sutatus_size">

                                                <div data-to.ggle="tooltip" title="{{ training.end_date|date:'Y/m/d H:i' }}">{{ training.end_date|date:'Y/m/d'}}</div>
                                                {% comment %} <div data-toggle="tooltip" title="{{ training_manage.training.end_date|date:'Y/m/d H:i' }}">{{ training_manage.training.end_date|date:'Y/m/d'}}</div> {% endcomment %}

                                                <div data-toggle="tooltip" title="{{ training.end_date|date:'Y/m/d H:i' }}">{{ training.end_date|date:'H:i'}}まで</div>
                                                {% comment %} <div data-toggle="tooltip" title="{{ training_manage.training.end_date|date:'Y/m/d H:i' }}">{{ training_manage.training.end_date|date:'H:i'}}まで</div> {% endcomment %}

                                                <div class="period_rem_date" data-period_date="{{ training.end_date|date:'Y/m/d H:i' }}">ステータス</div>
                                                {% comment %} <div class="period_rem_date" data-period_date="{{ training_manage.training.end_date|date:'Y/m/d H:i' }}">ステータス</div> {% endcomment %}

                                            </div>
                                        </div>

                                        {% comment %} <div class="d-none d-block mt-3 mb-3 ml-2 mr-3 menu_btn_color_div" {% if training|training_disabled %}style="pointer-events: none; opacity: 0.5;" title="開始時刻までは操作できません"{% endif %}> {% endcomment %}
                                        <div class="d-block mt-3 mb-3 ml-2 mr-3 menu_btn_color_div" {% if training|training_disabled %}style="pointer-events: none; opacity: 0.5;" title="開始時刻までは操作できません"{% endif %}>

                                            <!-- 期限切れトレーニングの有効化・無効化切り替えフラグがtrueの場合 -->
                                            {% if training.expired_training_flg %}
                                                <button type="button" class="menu_btn_color menu_btn my-btn" onclick="window.open('{% url 'training:questionnaire' parts.id %}', 'newwin', 'top=20,width=1280,height=720,resizable'); return false;" 
                                                {% if parts|btn_activate_ctl:current_user %}disabled{% endif %}>
                                                    <div class="row no-gutters">
                                                        <div class="col-10">
                                                            <div class="mt-2 mb-2 button_text_size">
                                                                アンケート
                                                            </div>
                                                        </div>
                                                        <div class="col-2">
                                                            <div class="mt-2 mb-2">
                                                                <i class="fas fa-external-link-alt fa-1x"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </button>
                                            {% else %}
                                                <button type="button" class="menu_btn_color menu_btn my-btn" onclick="window.open('{% url 'training:questionnaire' parts.id %}', 'newwin', 'top=20,width=1280,height=720,resizable'); return false;" 
                                                {% if training.end_date|training_check_date %}disabled{% endif %}
                                                {% if parts|btn_activate_ctl:current_user %}disabled{% endif %}>
                                                    <div class="row no-gutters">
                                                        <div class="col-10">
                                                            <div class="mt-2 mb-2 button_text_size">
                                                                アンケート
                                                            </div>
                                                        </div>
                                                        <div class="col-2">
                                                            <div class="mt-2 mb-2">
                                                                <i class="fas fa-external-link-alt fa-1x"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </button>
                                            {% endif %}
                                        </div>

                                    </div>
                                </div>

                            {% endif %}

                        {% endfor %}

                    </div>

                </div>

                {% endwith %}
                {% endwith %}
                {% endwith %}

            {% endfor %}

        </div><!-- row end -->

    {% endif %}

    <!-- ボタン -->
    <div class="d-flex justify-content-center btn-grp">
        <!-- 前のページに戻る -->
        <button type="button" class="my-btn return_btn my-btn-egypt-1 my-btn-w12" onclick="window.location.href='{% url 'training:training' %}'"><span class="my_btn_text">前のページに戻る</span></button>
    </div>

</div><!-- container-fluid end -->





{% endblock %}

{% block extra_js %}

<script>
    ///////////////////////////////////////////////////
    ////開閉機能　                                   ////
    ///////////////////////////////////////////////////

    $(function () {
        $(".js-accordion-title").on("click", function () {
            $(this).next().slideToggle(300);
            $(this).toggleClass("open", 300);
        });
    });
</script>


<script>
    // 5秒後にエラーメッセージを消す関数
    $('.messages').fadeIn("slow", function () {
        //コールバックで5秒後にフェードアウト
        $(this).delay(5000).fadeOut("slow");
    });
</script>


<script>
    /////////////////////////////////
    // トグルボタン展開縮小を記憶する  //
    ////////////////////////////////

    var guest_user_id = "{{guest_user_id}}";
    console.log("guest_user_id", guest_user_id)

    // トグルの展開縮小ON/OFF
    $(document).ready(function () {

        $(document).on('click', '.detailed_search_btn' ,function() { // クリックしたときに処理が動く

            is_checked = $(this).prop("checked")
            training_id = $(this).data('training_id')

            // 送信データとして保存 チェックをしたのか、していないのかの情報を取得
            var data = { 'is_checked' : is_checked, 'training_id': training_id, 'guest_user_id' : guest_user_id };

            $.ajax({
                type: 'POST',
                url: "{% url 'training:folder_is_open_change' %}",
                data: data,
                dataType: 'json',
                success: function(data){

                    if(data.is_open){// true
                        console.log("----------- trueです")

                    }else{
                        console.log("----------- falseです")
                    }

                }
            });

        });

    });

</script>


<script>

    /////////////////////////////////
    // トグルボタン展開縮小         //
    ////////////////////////////////

    // 読み込まれたときに開閉、縮小した状態を維持する
    $('input[type="checkbox"]').each(function() {

        var $closest = $(this).parent().parent().parent().parent().parent().find('.childe1')

        // 展開
        if ($(this).is(':checked')) {
            $closest.fadeOut(0).toggleClass("hidden");

        // 縮小
        } else {
            $closest.fadeIn(0).toggleClass("hidden");
        }

    });

    // +, -ボタンを押したとき
    $('.detailed_search_btn').change(function() {

        var $closest = $(this).parent().parent().parent().parent().parent().find('.childe1')

        // 展開
        if ($(this).is(':checked')) {
            $closest.fadeOut("slow").toggleClass("hidden");
        // 縮小
        } else {
            $closest.fadeIn("slow").toggleClass("hidden");
        }
    });

</script>


<script>
    /////////////////////////////////////////////////////
    // 完了済みのトレーニングの表示/非表示切り替え        //
    ////////////////////////////////////////////////////
    $(function() {

        // チェックボックスをチェックしたら発動
        $('input[name="check"]').change(function() {
            console.log("-------------- チェックしたよ")

            // prop()でチェックの状態を取得
            var done_disp_bool = $('#done_disp_bool').prop('checked');

            // もしpropがチェック状態だったら
            if (done_disp_bool) {
                // propでチェックと出力
                //$('#p01').text('propでチェック');
                console.log("--------------", done_disp_bool)
            } else {
                // テキストをリセット
                //$('#p01').text('');
                console.log("--------------", done_disp_bool)
            }


        });

    });

</script>






<script>
    /////////////////////
    // ファイルダウンロード  //
    /////////////////////

    $('.messages').fadeIn("slow", function () {
        //コールバックで5秒後にフェードアウト
        $(this).delay(5000).fadeOut("slow");
    });

</script>




<script>
    /////////////////////////////////////////////////////
    // 完了済みのトレーニングの表示/非表示切り替え        //
    ////////////////////////////////////////////////////

    // views.pyから送られてきた科目のidを取得
    var subject_id = "{{subject_id}}";
        console.log("subject_id", subject_id)

    // URLのパラメータの値を取得
    //var param = $(location).attr('pathname').split('/');

    // idのみを抽出
    //var training_id = param[2];
    //console.log("training_id", training_id);

    $('.incident_done_btn').on('click', function() {

        console.log("トレーニングの非表示ボタンがクリックされた");

        done_disp_bool = $(this).data('done_disp_bool')

        // 送信データとして保存
        //var data = { 'done_disp_bool': done_disp_bool, 'guest_user_id' : guest_user_id, 'training_id' : training_id };
        var data = { 'done_disp_bool': done_disp_bool, 'subject_id' : subject_id};

        $.ajax({
            type: 'POST',
            url: "{% url 'training:training_done_chg' %}",
            data: data,
            dataType: 'json',
            success: function(data){
                if(data.status=='ok'){
                    //window.location.href="/subject_training/" + data.training_id
                    window.location.href="/subject_training/" + data.subject_id
                }
            }
        });
    });




</script>




<script>

$(function () {

    /////////////////////
    // ファイルダウンロード  //
    /////////////////////

    // 5秒後にエラーメッセージを消す関数
    function messageTimer(){
        $('.messages').fadeIn("slow", function () {
            //コールバックで5秒後にフェードアウト
            $(this).delay(5000).fadeOut("slow");
        });
    }

    // 配布ファイルのダウンロードを取得
    $('.file_download a').on('click', function() {
        var is_type = "single"
        var file_id = $(this).attr('id');
        var parts_id = $(this).data('parts_id');

        // 送信データとして保存
        var data = { 'file_id': file_id, 'parts_id': parts_id, 'is_type': is_type};

        $.ajax({
            type: 'POST',
            url: "{% url 'training:file_download_status' %}",
            data: data,
            dataType: 'json',
            success: function(data){
                if(data.status=='ok'){
                    console.log("subject_pk", data.subject_pk)
                    //window.location.href = '/';
                    window.location.href = '/subject_training/' + data.subject_pk
                }else{
                    alert(data.message)
                }
            }
        });
    });



    // 配布ファイルのダウンロードを取得
    $('.zip_download').on('click', function() {
        var is_type = "multiple"
        var file_id = $(this).attr('id');
        var parts_id = $(this).data('parts_id');

        // 送信データとして保存
        var data = { 'file_id': file_id, 'parts_id': parts_id, 'is_type': is_type};


        console.log("bbb")

        $.ajax({
            type: 'POST',
            url: "{% url 'training:file_download_status' %}",
            data: data,
            dataType: 'json',
            success: function(data){
                if(data.status=='ok'){
                    //alert(data.message)
                    //console.log('#' + file_id > ".download_status")
                    console.log("subject_pk", data.subject_pk)
                    //window.location.href = '/';
                    window.location.href = '/subject_training/' + data.subject_pk
                }else{
                    //alert(data.message)
                }
            }
        });
    });

    /////////////////////
    // 有効期限の表示    //
    /////////////////////
    $('.period_rem_date').each(function(){

        // 現在日時
        var current = new Date();

        // 期限(文字列)
        period_date_str = $(this).data('period_date')
        console.log("期限ストリング")
        console.log(period_date_str)

        // 期限
        var period_date = new Date( period_date_str )

        // 公開日時ミリ秒
        var period_date = period_date.getTime();

        // 日付差分
        var diff_date =  period_date - current

        // 日に変換
        var rem_day = Math.floor(diff_date / (1000 * 60 * 60 *24));

        // 日に1日を加算
        var rem_day_add = rem_day + 1;
        console.log("日に1日を加算")
        console.log(rem_day_add)

        // 2日以下の場合は赤
        if (rem_day_add <= 2) {
        $(this).css("color", "#ff0000");

        // 6日以下の場合は黄色
        } else if (rem_day_add <= 6) {
        $(this).css("color", "#ffa500");

        // それ以外は青
        } else {
        $(this).css("color", "#0000ff");
        }

        // 30日以上の場合は一ヶ月以上と表示
        if (rem_day_add >= 30) {
        $(this).text("残り30日以上");

        } else if (rem_day_add < 0) {
        $(this).text("期限切れ");
        // ボタンを操作できなくする
        //$(this).parent().parent().parent().children().children(".menu_btn_color").prop("disabled", true);
        //$(this).parent().parent().parent().children(".menu_btn_color_div").attr('title', '期限が切れているため操作できません');

        // それ以外は日数を表示
        } else {
        // 残り時間を表示
        $(this).text("残り" + rem_day_add + "日");
        }

        // // 中央揃え
        // $(this).css("text-align", "center");

    });


    /////////////////////
    // 有効期限の表示    //
    /////////////////////
    // $('.top_period_rem_date').each(function(){

        // 現在日時
        //  var current = new Date();

        // 期限(文字列)
        // period_date_str = $(this).data('period_date')
        // 期限
        // var period_date = new Date( period_date_str )
        // 公開日時ミリ秒
        // var period_date = period_date.getTime();

        // 日付差分
        // var diff_date =  period_date - current

        // 日に変換
        // var rem_day = Math.floor(diff_date / (1000 * 60 * 60 *24));

        // 日に1日を加算
        // var rem_day_add = rem_day + 1;
        // 2日以下の場合は赤
        // if (rem_day_add <= 2) {
        //$(this).css("color", "#ff0000");

        // 6日以下の場合は黄色
        // } else if (rem_day_add <= 6) {
        //$(this).css("color", "#ffa500");

        // それ以外は青
        // } else {
        //$(this).css("color", "#0000ff");
        //}

        // 30日以上の場合は一ヶ月以上と表示
        // if (rem_day_add >= 30) {
        // $(this).text("残り30日以上");

        // } else if (rem_day_add < 0) {
        // $(this).text("期限切れ");

        // それ以外は日数を表示
        // } else {
        // 残り時間を表示
        // $(this).text("残り" + rem_day_add + "日");
        // }

        // // 中央揃え
        // $(this).css("text-align", "center");

    // });

    /////////////////////
    // ボタンの有効・無効 //
    /////////////////////
    {% comment %} $('.card').each(function(){

        card_value = $(this)

        before_card_value = card_value.prev()

        before_card_status = before_card_value.find('.label_status').text()

        //console.log(before_card_status)

        // 前のカードのステータスが完了以外だった場合
        if (before_card_status !== "完了") {

            //カレントカードのボタンオブジェクトを取得
            current_card_button = $(this).find('button')
            //console.log(current_card_button.first().text().trim())
            //console.log(typeof(current_card_button.first().text()))

            // カレントカードのボタン名がまとめてダウンロード以外だった場合
            if (current_card_button.first().text().trim() !== "まとめてダウンロード") {
                // ボタンを無効化
                current_card_button.prop("disabled", true);

            // カレントカードのボタン名がまとめてダウンロードだった場合
            } else {
                // console.log("ダウンロードいがい")
                if (card_value.find('.label_status').text() === "完了") {
                    current_card_button.prop("disabled", true);

                } else {
                    current_card_button.prop("disabled", false);

                }

            }

            if (card_value.find('.movie_title').text() == "令和2年度新任主査級職員研修動画（基礎編）") {
                console.log("人事課主査")

                current_card_button.prop("disabled", false);
            }

            console.log(card_value.find('.movie_title').text())

        } else {
            console.log("aa")
        }

    }); {% endcomment %}



    ///////////////////
    // Newラベルの表示 //
    ///////////////////
    $('.new').each(function(){
        // 現在日時
        var current = new Date();
        // 6時間前のミリ秒を取得
        var range = current - (6 * 60 * 60 * 1000);
        // 作成日時(文字列)
        created_date_str = $(this).data('created_time')
        // 作成日時
        var created_date = new Date( created_date_str )
        // 作成日時ミリ秒
        var created_date_ms = created_date.getTime();
        // 作成日が、６時間前の時間を超えたら非表示
        if (range > created_date_ms){
            $(this).css("display", "inline-block");
        }else{
            $(this).css("display", "none");
        }
    });



    {% comment %} $('.card').each(function(){
        card_value = $(this)

        current_card_status = $(this).find('.label_status').first().text()
        console.log(current_card_status)
        if (current_card_status === "完了") {
            next_card_button = card_value.next().find('button')
            console.log(next_card_button)
            next_card_button.prop("disabled", true);
            console.log("aaa")
        }



    }); {% endcomment %}



});

</script>

{% endblock %}
